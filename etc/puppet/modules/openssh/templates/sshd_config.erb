# File Generated By Puppet
#   Last Modified ( <%= File.ctime( "/vagrant/etc/puppet/modules/openssh/templates/sshd_config.erb" ) -%> ) <%# 
#
#   Parameters
#   ==========
#
#       port            - Bind Port
#       syslogFacility  - Log Level
#       serverKeyBits   - ssh key length
#       logLevel        - Logging verbosity
#       permitRoot      - allow remote root
#       maxAuthTries    - max authentication tries
#       maxSessions     - max concurrent connections
#       allowGroups     - Groups to allow access to
#       sftpGroup       - Group to provide sftp only access
#       keys_only       - Disable passwords altogether
#
# %>
#

Port <%= @port %> 
Protocol 2
ServerKeyBits <%= @serverKeyBits %> 
SyslogFacility <%= @syslogFacility %> 
LogLevel <%= @logLevel %>

### Auth
PermitRootLogin <%= @permitRoot %> 
MaxAuthTries <%= @maxAuthTries %>
MaxSessions <%= @maxSessions %>

# Allow Keyed Entry
PubkeyAuthentication yes

# Change to no to disable password logins
<%- if @keys_only == true -%>
PasswordAuthentication no 
<%- else -%>
PasswordAuthentication yes
<%- end -%>

# Change to no to disable s/key passwords
ChallengeResponseAuthentication no

GSSAPIAuthentication no
GSSAPICleanupCredentials yes

UsePAM yes

AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
AcceptEnv XMODIFIERS

AllowTcpForwarding no
X11Forwarding no
GatewayPorts no
PermitTunnel <%= @permitTunnel %>

Subsystem sftp internal-sftp

<%- if @allowGroups.is_a? (Array) -%>
AllowGroups <%- @allowGroups.each do |group| -%><%= "#{group} " -%><%- end -%>

<%- elsif @allowGroups != '' -%>
AllowGroups <%= @allowGroups %>
<%- end -%>

Match Group tunnels
  AllowTcpForwarding yes
  GatewayPorts yes

Match Group <%= @sftpGroup %>
  ChrootDirectory %h
  ForceCommand internal-sftp 
